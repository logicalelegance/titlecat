# Trinket IO demo
# Welcome to CircuitPython 3.1.1 :)

import board
import busio
import time
import math
import as1130
import display
import gc

# Font
font_5x5_data =[
	[0b0,0b0,0b0,0b0,0b0], #
	[0b10000000,0b10000000,0b10000000,0b0,0b10000000], # !
	[0b10100000,0b0,0b0,0b0,0b0], # "
	[0b1010000,0b11111000,0b1010000,0b11111000,0b1010000], # #
	[0b11111000,0b10100000,0b11111000,0b101000,0b11111000], # $
	[0b10001000,0b10000,0b100000,0b1000000,0b10001000], # %
	[0b1100000,0b10000000,0b1101000,0b10010000,0b1101000], # &
	[0b10000000,0b0,0b0,0b0,0b0], # '
	[0b1000000,0b10000000,0b10000000,0b10000000,0b1000000], # (
	[0b10000000,0b1000000,0b1000000,0b1000000,0b10000000], # )
	[0b1000000,0b0,0b0,0b0,0b0], # *
	[0b100000,0b100000,0b11111000,0b100000,0b100000], # +
	[0b0,0b0,0b0,0b0,0b10000000], # ,
	[0b0,0b0,0b11111000,0b0,0b0], # -
	[0b0,0b0,0b0,0b0,0b10000000], # .
	[0b100000,0b100000,0b1000000,0b10000000,0b10000000], # /
	[0b11111000,0b10011000,0b10101000,0b11001000,0b11111000], # 0
	[0b1000000,0b11000000,0b1000000,0b1000000,0b11100000], # 1
	[0b11110000,0b1000,0b1110000,0b10000000,0b11111000], # 2
	[0b11111000,0b1000,0b1110000,0b1000,0b11111000], # 3
	[0b10000000,0b10000000,0b10100000,0b11111000,0b100000], # 4
	[0b11111000,0b10000000,0b11110000,0b1000,0b11110000], # 5
	[0b11111000,0b10000000,0b11111000,0b10001000,0b11111000], # 6
	[0b11111000,0b1000,0b10000,0b100000,0b100000], # 7
	[0b11111000,0b10001000,0b11111000,0b10001000,0b11111000], # 8
	[0b11111000,0b10001000,0b11111000,0b1000,0b11111000], # 9
	[0b10000000,0b0,0b0,0b0,0b10000000], # :
	[0b10000000,0b0,0b0,0b0,0b10000000], # ;
	[0b100000,0b1000000,0b10000000,0b1000000,0b100000], # <
	[0b0,0b11111000,0b0,0b11111000,0b0], # =
	[0b10000000,0b1000000,0b100000,0b1000000,0b10000000], # >
	[0b1100000,0b10010000,0b100000,0b0,0b100000], # ?
	[0b11111000,0b10001000,0b10111000,0b10000000,0b11111000], # @
	[0b11111000,0b10001000,0b10001000,0b11111000,0b10001000], # A
	[0b11111000,0b10001000,0b11110000,0b10001000,0b11111000], # B
	[0b11111000,0b10000000,0b10000000,0b10000000,0b11111000], # C
	[0b11110000,0b10001000,0b10001000,0b10001000,0b11110000], # D
	[0b11111000,0b10000000,0b11110000,0b10000000,0b11111000], # E
	[0b11111000,0b10000000,0b11110000,0b10000000,0b10000000], # F
	[0b11111000,0b10000000,0b10011000,0b10001000,0b11111000], # G
	[0b10001000,0b10001000,0b11111000,0b10001000,0b10001000], # H
	[0b11111000,0b100000,0b100000,0b100000,0b11111000], # I
	[0b11000,0b1000,0b1000,0b10001000,0b11111000], # J
	[0b10001000,0b10010000,0b11100000,0b10010000,0b10001000], # K
	[0b10000000,0b10000000,0b10000000,0b10000000,0b11111000], # L
	[0b10001000,0b11011000,0b10101000,0b10001000,0b10001000], # M
	[0b10001000,0b11001000,0b10101000,0b10011000,0b10001000], # N
	[0b1110000,0b10001000,0b10001000,0b10001000,0b1110000], # O
	[0b11110000,0b10001000,0b11110000,0b10000000,0b10000000], # P
	[0b11111000,0b10001000,0b10001000,0b11111000,0b100000], # Q
	[0b11110000,0b10001000,0b11110000,0b10001000,0b10001000], # R
	[0b11111000,0b10000000,0b11111000,0b1000,0b11111000], # S
	[0b11111000,0b100000,0b100000,0b100000,0b100000], # T
	[0b10001000,0b10001000,0b10001000,0b10001000,0b11111000], # U
	[0b10001000,0b10001000,0b1010000,0b1010000,0b100000], # V
	[0b10001000,0b10001000,0b10101000,0b10101000,0b1010000], # W
	[0b10001000,0b1010000,0b100000,0b1010000,0b10001000], # X
	[0b10001000,0b10001000,0b1010000,0b100000,0b100000], # Y
	[0b11111000,0b10000,0b100000,0b1000000,0b11111000], # Z
	[0b11000000,0b10000000,0b10000000,0b10000000,0b11000000], # [
	[0b10000000,0b10000000,0b1000000,0b100000,0b100000], # "\"
	[0b11000000,0b1000000,0b1000000,0b1000000,0b11000000], # ]
	[0b0,0b0,0b0,0b0,0b0], # ^
	[0b0,0b0,0b0,0b0,0b11111000], # _
	[0b0,0b0,0b0,0b0,0b0], # `
	[0b11111000,0b10001000,0b10001000,0b11111000,0b10001000], # a
	[0b11111000,0b10001000,0b11110000,0b10001000,0b11111000], # b
	[0b11111000,0b10000000,0b10000000,0b10000000,0b11111000], # c
	[0b11110000,0b10001000,0b10001000,0b10001000,0b11110000], # d
	[0b11111000,0b10000000,0b11110000,0b10000000,0b11111000], # e
	[0b11111000,0b10000000,0b11110000,0b10000000,0b10000000], # f
	[0b11111000,0b10000000,0b10011000,0b10001000,0b11111000], # g
	[0b10001000,0b10001000,0b11111000,0b10001000,0b10001000], # h
	[0b11111000,0b100000,0b100000,0b100000,0b11111000], # i
	[0b11000,0b1000,0b1000,0b10001000,0b11111000], # j
	[0b10001000,0b10010000,0b11100000,0b10010000,0b10001000], # k
	[0b10000000,0b10000000,0b10000000,0b10000000,0b11111000], # l
	[0b10001000,0b11011000,0b10101000,0b10001000,0b10001000], # m
	[0b10001000,0b11001000,0b10101000,0b10011000,0b10001000], # n
	[0b1110000,0b10001000,0b10001000,0b10001000,0b1110000], # o
	[0b11110000,0b10001000,0b11110000,0b10000000,0b10000000], # p
	[0b11111000,0b10001000,0b10001000,0b11111000,0b100000], # q
	[0b11110000,0b10001000,0b11110000,0b10001000,0b10001000], # r
	[0b11111000,0b10000000,0b11111000,0b1000,0b11111000], # s
	[0b11111000,0b100000,0b100000,0b100000,0b100000], # t
	[0b10001000,0b10001000,0b10001000,0b10001000,0b11111000], # u
	[0b10001000,0b10001000,0b1010000,0b1010000,0b100000], # v
	[0b10001000,0b10001000,0b10101000,0b10101000,0b1010000], # w
	[0b10001000,0b1010000,0b100000,0b1010000,0b10001000], # x
	[0b10001000,0b10001000,0b1010000,0b100000,0b100000], # y
	[0b11111000,0b10000,0b100000,0b1000000,0b11111000], # z
	[0b1100000,0b1000000,0b11000000,0b1000000,0b1100000], # {
	[0b10000000,0b10000000,0b0,0b10000000,0b10000000], # |
	[0b11000000,0b1000000,0b1100000,0b1000000,0b11000000], # }
	[0b0,0b0,0b0,0b0,0b0], # ~
	[0x00,0x00,0x00,0x00,0x00]
]

# Start of application code

## Init the AS1130
i2c = busio.I2C(board.SCL, board.SDA)
time.sleep(0.5)
led = as1130.AS1130_I2C(i2c)

fb = display.FrameBuffer(24*12, 5)

ledfont = display.font(5, 5, font_5x5_data)

time.sleep(2)
led.play_movie(True)

######################### MAIN LOOP ##############################

titlefile = open("/show_titles.txt", "r")

# Read first title
title = titlefile.readline()

while True:
    gc.collect()
    fb.clear_buffer()
    string_length = fb.draw_string(0, 0, title[:-1], ledfont) # remove CR
    led.draw_framebuffer(fb, string_length)
    time.sleep(10)

    title = titlefile.readline()
    if title == "":
        titlefile.seek(0,0)
        title = titlefile.readline()

#for index in range(0, 192):
#    sinval = math.sin(index/4) * 2.5 + 2.5
#    fb.set_pixel_value(index, int(sinval), 0xFF)
#    fb.set_pixel_value(index, abs(4-int(sinval)), 0xFF)